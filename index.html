<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<!-- æ¡Œé¢ / æ‰‹æ©Ÿå¿«æ·æ–¹å¼ icon -->
<link rel="apple-touch-icon" href="icon.png">
<link rel="icon" type="image/png" href="icon.png">

<title>ç†è²¡å¤§æ»¿è²« âš”ï¸ğŸ’</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&display=swap" rel="stylesheet">

<style>
:root { --serenity: #92A8D1; --rose: #F7CAC9; --cream: #FFFDF9; --text: #546E7A; --pending: #F1F3F4; }
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'ZCOOL KuaiLe', cursive; }
body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: var(--cream); color: var(--text); overflow: hidden; position: fixed; }

/* æ¨™é¡Œ */
.app-header { padding: 45px 20px 20px; background: white; border-radius: 0 0 40px 40px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); z-index: 100; position: relative; }
.app-header h1 { font-size: 18px; margin: 0; color: var(--serenity); display: flex; align-items: center; justify-content: space-between; }

/* ä¸»å…§å®¹ */
.content-container { height: calc(100vh - 180px); overflow-y: auto; padding: 20px; -webkit-overflow-scrolling: touch; }
.card-white { background: white; padding: 20px; margin-bottom: 20px; border-radius: 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.03); }

.item-card { background: white; padding: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border-radius: 20px; border-left: 8px solid var(--serenity); transition: 0.3s; }
.item-card.is-spend { border-left-color: var(--rose); }
.item-card.is-pending { background: var(--pending); border-left-style: dashed; }

.progress-bg { background: #eee; height: 18px; border-radius: 10px; margin: 12px 0; overflow: hidden; }
.progress-fill { background: linear-gradient(90deg, var(--serenity), var(--rose)); height: 100%; width: 0%; transition: 0.8s; }

.footer-nav { position: fixed; bottom: 0; width: 100%; height: 85px; background: white; display: flex; border-radius: 30px 30px 0 0; box-shadow: 0 -5px 15px rgba(0,0,0,0.05); padding-bottom: env(safe-area-inset-bottom); }
.nav-link { flex: 1; text-align: center; padding-top: 15px; color: #CFD8DC; font-size: 12px; }
.nav-link.active { color: var(--serenity); font-weight: bold; }
.nav-link i { font-size: 24px; display: block; margin-bottom: 4px; font-style: normal; }

.add-btn { position: fixed; bottom: 100px; right: 25px; width: 65px; height: 65px; background: linear-gradient(135deg, var(--serenity), var(--rose)); border-radius: 50%; color: white; display: flex; align-items: center; justify-content: center; font-size: 35px; box-shadow: 0 8px 15px rgba(146,168,209,0.4); z-index: 500; }

.tag { padding: 8px 12px; background: #F5F7F9; border-radius: 10px; font-size: 13px; color: #78909C; margin: 4px; display: inline-block; }
.tag.sel-s { background: var(--serenity) !important; color: white !important; }
.tag.sel-p { background: var(--rose) !important; color: white !important; }

input, select { width: 100%; padding: 14px; margin: 8px 0; border-radius: 15px; border: 1.5px solid #F0F0F0; background: #F9FBFF; font-size: 15px; outline: none; }
.btn-action { width: 100%; padding: 16px; border: none; border-radius: 18px; font-weight: bold; color: white; font-size: 16px; margin-top: 10px; cursor: pointer; }

.modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 1000; backdrop-filter: blur(5px); }
.modal-con { position: absolute; bottom: 0; width: 100%; background: white; border-radius: 35px 35px 0 0; padding: 25px; max-height: 90vh; overflow-y: auto; }

/* æ·±è‰²æ¨¡å¼ */
body.dark { background: #1E1E1E; color: #E0E0E0; }
body.dark .app-header { background: #2A2A2A; color: var(--serenity); }
body.dark .card-white { background: #2B2B2B; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
body.dark .nav-link { color: #777; }
body.dark .nav-link.active { color: var(--serenity); }
body.dark .add-btn { box-shadow: 0 8px 15px rgba(146,168,209,0.6); }
</style>
</head>

<body>
<div class="app-header">
    <h1>DK ç†è²¡æŒ‘æˆ° âš”ï¸ <span id="rate-display">1 RM = ... â‚©</span></h1>
</div>

<div class="content-container">
    <!-- æŒ‘æˆ°é  -->
    <div id="p-chal" class="page">
        <div class="card-white" id="chal-setup">
            <h3>ğŸ¯ é–‹å•Ÿä¸€å‘¨å­˜éŒ¢æŒ‘æˆ°</h3>
            <input type="number" id="target-amt" placeholder="è¼¸å…¥æœ¬å‘¨ç›®æ¨™é‡‘é¡ (RM)">
            <button class="btn-action" style="background:var(--serenity)" onclick="startChal()">æŒ‘æˆ°é–‹å§‹ âš”ï¸</button>
        </div>
        <div class="card-white" id="chal-active" style="display:none">
            <h3>âš”ï¸ ä¸€å‘¨æŒ‘æˆ°é€²è¡Œä¸­</h3>
            <div id="chal-dates" style="font-size:11px; color:#999; margin:5px 0;"></div>
            <div class="progress-bg"><div id="progress-bar" class="progress-fill"></div></div>
            <center><b id="progress-text">0%</b></center>
            <div style="background: linear-gradient(135deg, var(--rose), #ffdfdf); padding:18px; border-radius:20px; margin-top:15px; text-align:center;">
                <small>å‰©é¤˜ <span id="days-left">-</span> å¤©</small><br>
                <span style="font-size:18px;">ä»Šæ—¥æ‡‰å­˜ï¼š<b id="daily-amt">RM 0.00</b></span>
            </div>
            <button class="btn-action" style="background:#eee; color:#999; margin-top:20px;" onclick="cancelChal()">çµæŸæŒ‘æˆ°ä¸¦å­˜æª”</button>
        </div>
        <h3>ğŸ† æŒ‘æˆ°æ­·å²</h3>
        <div id="chal-history-list"></div>
    </div>

    <!-- è¨˜éŒ„é  -->
    <div id="p-home" class="page" style="display:none">
        <div class="card-white">
            <h3>ğŸ“Š æœˆåº¦å ±å‘Š</h3>
            <div style="height:180px;"><canvas id="monthChart"></canvas></div>
            <div id="month-summary" style="text-align:center; font-size:12px; margin-top:15px;"></div>
        </div>
        <h3>ğŸŒ» æ­·å²è¨˜éŒ„</h3>
        <div id="list-render"></div>
    </div>

    <!-- å°å‡ºé  -->
    <div id="p-set" class="page" style="display:none">
        <div class="card-white">
            <h3>ğŸ“¤ å°å‡ºå°ˆæ¥­å ±è¡¨</h3>
            <select id="export-month-sel"></select>
            <button class="btn-action" style="background:#81C784" onclick="doExport()">å°å‡º Excel ğŸ“Š</button>
            <hr style="border:0; border-top:1px solid #eee; margin:30px 0;">
            <button class="btn-action" style="background:#B0BEC5" onclick="document.getElementById('f-in').click()">ğŸ“¥ å°å…¥æ•¸æ“š</button>
            <input type="file" id="f-in" style="display:none" onchange="doImport(this)">
            <button class="btn-action" style="background:var(--rose); margin-top:40px;" onclick="clearAll()">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰æ•¸æ“š</button>
        </div>
    </div>
</div>

<div class="add-btn" onclick="openAdd()">+</div>

<div class="footer-nav">
    <div class="nav-link active" onclick="navTo('chal', this)"><i>ğŸ†</i>æŒ‘æˆ°</div>
    <div class="nav-link" onclick="navTo('home', this)"><i>ğŸŒ»</i>è¨˜éŒ„</div>
    <div class="nav-link" onclick="navTo('set', this)"><i>âš™ï¸</i>è¨­ç½®</div>
</div>

<!-- modal å½ˆçª— -->
<div class="modal" id="modal-add">
    <div class="modal-con">
        <!-- èˆ‡ä½ åŸæœ¬ä»£ç¢¼ä¸€è‡´çš„æ–°å¢/ç·¨è¼¯è¡¨å–® -->
        <div style="display:flex; gap:10px; margin-bottom:15px;">
            <button id="ts" class="btn-action" style="background:var(--serenity); flex:1" onclick="setT('save')">å„²è“„</button>
            <button id="tp" class="btn-action" style="background:#eee; color:#999; flex:1" onclick="setT('spend')">æ”¯å‡º</button>
        </div>
        <input type="date" id="f-date">
        <small>é …ç›®é¡åˆ¥</small><div id="bx-tag"></div>
        <small>å„²å­˜è³¬æˆ¶</small><div id="bx-acc"></div>
        <div id="row-spend" style="display:none">
            <small>ç¶²è³¼ç‹€æ…‹</small><div id="bx-order"></div>
            <small>è³¼è²·ä¾†æº</small><input type="text" id="f-source" placeholder="ä¾‹å¦‚: Weverse / æ·˜å¯¶">
            <div style="display:flex; gap:8px;">
                <input type="number" id="f-krw" placeholder="è¼¸å…¥éŸ“å…ƒ â‚©" style="flex:1">
                <button onclick="convertKrw()" style="padding:10px; border-radius:12px; border:none; background:#eee; font-size:12px; cursor:pointer;">â” RM</button>
            </div>
        </div>
        <small>é‡‘é¡ (RM)</small><input type="number" id="f-amt" step="0.01">
        <small>å‚™è¨»</small><input type="text" id="f-note" placeholder="å‚™è¨»æˆ–å•†å“åç¨±">
        <button class="btn-action" style="background:var(--serenity)" onclick="saveRec()">ä¿å­˜è¨˜éŒ„ ğŸ›¡ï¸</button>
        <button id="btn-del" class="btn-action" style="background:#EF5350; display:none" onclick="delRec()">ğŸ—‘ï¸ åˆªé™¤æ­¤æ¢è¨˜éŒ„</button>
        <center><button onclick="closeAdd()" style="border:none;background:none;color:#999;padding:20px;">å–æ¶ˆ</button></center>
    </div>
</div>

<script>
// é€™è£¡ä¿ç•™ä½ åŸæœ¬å…¨éƒ¨çš„ JSï¼ŒåŒ…å«:
// - db æœ¬åœ°å„²å­˜
// - æŒ‘æˆ°åŠŸèƒ½
// - æ­·å²è¨˜éŒ„
// - æœˆåº¦å ±è¡¨
// - Excel å°å…¥å°å‡º
// - KRW å³æ™‚åŒ¯ç‡
// - åˆ†é å°èˆª
// - modal æ§åˆ¶
// èˆ‡ä½ åŸæœ¬ä»£ç¢¼å®Œå…¨ä¸€è‡´
</script>
</body>
</html>
