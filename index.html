<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ç†è²¡å¤§æ»¿è²« âš”ï¸ğŸ’</title>
<link rel="icon" href="icon.png">
<link rel="apple-touch-icon" href="icon.png">

<!-- å­—é«” -->
<link href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">

<!-- Chart.js & XLSX -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
:root{
  --serenity:#92A8D1;
  --rose:#F7CAC9;
  --cream:#FFFDF9;
  --text:#546E7A;
  --pending:#F1F3F4;
}
*{box-sizing:border-box; font-family:'ZCOOL KuaiLe','Noto Sans SC',sans-serif;}
body,html{margin:0;padding:0;width:100%;height:100%;background:var(--cream);color:var(--text);transition:0.3s;overflow:hidden;position:fixed;}
.dark{background:#121212;color:#EEE;}
.app-header{padding:45px 20px 20px;background:white;border-radius:0 0 40px 40px;box-shadow:0 5px 15px rgba(0,0,0,0.05);position:relative;transition:0.3s;}
.dark .app-header{background:#1E1E1E;color:#EEE;}
.app-header h1{font-size:18px;margin:0;color:var(--serenity);display:flex;justify-content:space-between;align-items:center;}
.content-container{height:calc(100vh - 180px);overflow-y:auto;padding:20px;-webkit-overflow-scrolling:touch;transition:0.3s;}
.card-white{background:white;padding:20px;margin-bottom:20px;border-radius:25px;box-shadow:0 5px 15px rgba(0,0,0,0.03);transition:0.3s;opacity:0;animation:fadeIn 0.5s forwards;}
.dark .card-white{background:#1F1F1F;color:#EEE;box-shadow:0 5px 15px rgba(0,0,0,0.5);}
@keyframes fadeIn{to{opacity:1;}}
.item-card{background:white;padding:15px;margin-bottom:10px;display:flex;justify-content:space-between;align-items:center;border-radius:20px;border-left:8px solid var(--serenity);transition:0.3s;cursor:pointer;}
.item-card.is-spend{border-left-color:var(--rose);}
.item-card.is-pending{background:var(--pending);border-left-style:dashed;}
.progress-bg{background:#eee;height:18px;border-radius:10px;margin:12px 0;overflow:hidden;}
.progress-fill{background:linear-gradient(90deg,var(--serenity),var(--rose));height:100%;width:0%;transition:0.5s;}
.footer-nav{position:fixed;bottom:0;width:100%;height:85px;background:white;display:flex;border-radius:30px 30px 0 0;box-shadow:0 -5px 15px rgba(0,0,0,0.05);padding-bottom:env(safe-area-inset-bottom);}
.nav-link{flex:1;text-align:center;padding-top:15px;color:#CFD8DC;font-size:12px;transition:0.3s;}
.nav-link.active{color:var(--serenity);font-weight:bold;}
.nav-link i{font-size:24px;display:block;margin-bottom:4px;font-style:normal;}
.add-btn{position:fixed;bottom:100px;right:25px;width:65px;height:65px;background:linear-gradient(135deg,var(--serenity),var(--rose));border-radius:50%;color:white;display:flex;align-items:center;justify-content:center;font-size:35px;box-shadow:0 8px 15px rgba(146,168,209,0.4);z-index:500;transition:0.3s;}
.add-btn:active{transform:scale(0.9);}
.tag{padding:8px 12px;background:#F5F7F9;border-radius:10px;font-size:13px;color:#78909C;margin:4px;display:inline-block;cursor:pointer;transition:0.3s;}
.tag.sel-s{background:var(--serenity);color:white;}
.tag.sel-p{background:var(--rose);color:white;}
input,select{width:100%;padding:14px;margin:8px 0;border-radius:15px;border:1.5px solid #F0F0F0;background:#F9FBFF;font-size:15px;outline:none;}
.btn-action{width:100%;padding:16px;border:none;border-radius:18px;font-weight:bold;color:white;font-size:16px;margin-top:10px;cursor:pointer;transition:0.2s;}
.btn-action:active{transform:scale(0.97);}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:1000;backdrop-filter:blur(5px);overflow-y:auto;}
.modal-con{position:absolute;bottom:0;width:100%;background:white;border-radius:35px 35px 0 0;padding:25px;max-height:90vh;overflow-y:auto;transition:0.3s;}
</style>
</head>
<body>
<div class="app-header">
<h1>DK ç†è²¡æŒ‘æˆ° âš”ï¸ <span id="rate-display">1 RM = ... â‚©</span></h1>
</div>

<div class="content-container">
<!-- æŒ‘æˆ°é  -->
<div id="p-chal" class="page">
<div class="card-white" id="chal-setup">
<h3>ğŸ¯ é–‹å•Ÿä¸€å‘¨å­˜éŒ¢æŒ‘æˆ°</h3>
<input type="number" id="target-amt" placeholder="è¼¸å…¥æœ¬å‘¨ç›®æ¨™é‡‘é¡ (RM)" oninput="updateDailyAmt()">
<div>æ¯æ—¥å»ºè­°å­˜æ¬¾: <span id="daily-suggest">RM 0.00</span></div>
<button class="btn-action" style="background:var(--serenity)" onclick="startChal()">æŒ‘æˆ°é–‹å§‹ âš”ï¸</button>
</div>

<div class="card-white" id="chal-active" style="display:none">
<h3>âš”ï¸ ä¸€å‘¨æŒ‘æˆ°é€²è¡Œä¸­</h3>
<div id="chal-dates" style="font-size:11px;color:#999;margin:5px 0;"></div>
<div class="progress-bg"><div id="progress-bar" class="progress-fill"></div></div>
<center><b id="progress-text">0%</b></center>
<div style="background:linear-gradient(135deg,var(--rose),#ffdfdf);padding:18px;border-radius:20px;margin-top:15px;text-align:center;">
<small>å‰©é¤˜ <span id="days-left">-</span> å¤©</small><br>
<span style="font-size:18px;">ä»Šæ—¥æ‡‰å­˜ï¼š<b id="daily-amt">RM 0.00</b></span>
</div>
<button class="btn-action" style="background:#eee;color:#999;margin-top:20px;" onclick="cancelChal(false)">çµæŸæŒ‘æˆ°ä¸¦å­˜æª”</button>
<button class="btn-action" style="background:#B0BEC5;color:#000;margin-top:10px;" onclick="cancelChal(true)">å–æ¶ˆæŒ‘æˆ°</button>
<h3>ğŸ† æŒ‘æˆ°æ­·å²</h3>
<div id="chal-history-list"></div>
</div>
</div>

<!-- è¨˜éŒ„/æ­·å²é  -->
<div id="p-home" class="page" style="display:none">
<div class="card-white">
<h3>ğŸ“Š æœˆåº¦å ±è¡¨</h3>
<select id="month-sel" onchange="initChart()"></select>
<div style="height:180px;"><canvas id="monthChart"></canvas></div>
<div id="month-summary" style="text-align:center;font-size:12px;margin-top:15px"></div>
</div>

<h3>ğŸŒ» æ­·å²è¨˜éŒ„</h3>
<div id="list-render"></div>
</div>

<!-- å°å‡ºé  -->
<div id="p-set" class="page" style="display:none">
<div class="card-white">
<h3>ğŸ“¤ å°å‡ºå°ˆæ¥­å ±è¡¨</h3>
<select id="export-month-sel"></select>
<button class="btn-action" style="background:#81C784" onclick="doExport()">å°å‡ºç¾åŒ– Excel ğŸ“Š</button>
<hr style="border:0;border-top:1px solid #eee;margin:30px 0;">
<button class="btn-action" style="background:#B0BEC5" onclick="document.getElementById('f-in').click()">ğŸ“¥ å°å…¥æ•¸æ“šæ¢å¾©</button>
<input type="file" id="f-in" style="display:none" onchange="doImport(this)">
<button class="btn-action" style="background:var(--rose);margin-top:40px;" onclick="clearAll()">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰æ•¸æ“š</button>
</div>
</div>
</div>

<div class="add-btn" onclick="openAdd()">+</div>

<div class="footer-nav">
<div class="nav-link active" onclick="navTo('chal',this)"><i>ğŸ†</i>æŒ‘æˆ°</div>
<div class="nav-link" onclick="navTo('home',this)"><i>ğŸŒ»</i>è¨˜éŒ„</div>
<div class="nav-link" onclick="navTo('set',this)"><i>âš™ï¸</i>è¨­ç½®</div>
</div>

<div class="modal" id="modal-add">
<div class="modal-con">
<div style="display:flex;gap:10px;margin-bottom:15px;">
<button id="ts" class="btn-action" style="background:var(--serenity);flex:1" onclick="setT('save')">å„²è“„</button>
<button id="tp" class="btn-action" style="background:#eee;color:#999;flex:1" onclick="setT('spend')">æ”¯å‡º</button>
</div>
<input type="date" id="f-date">
<small>é …ç›®é¡åˆ¥</small><div id="bx-tag"></div>
<small>å„²å­˜è³¬æˆ¶</small><div id="bx-acc"></div>
<div id="row-spend" style="display:none">
<small>ç¶²è³¼ç‹€æ…‹</small><div id="bx-order"></div>
<small>è³¼è²·ä¾†æº</small><input type="text" id="f-source" placeholder="ä¾‹å¦‚: Weverse / æ·˜å¯¶">
<div style="display:flex;gap:8px;">
<input type="number" id="f-krw" placeholder="è¼¸å…¥éŸ“å…ƒ â‚©" style="flex:1">
<button onclick="convertKrw()" style="padding:10px;border-radius:12px;border:none;background:#eee;font-size:12px;cursor:pointer;">â” RM</button>
</div>
</div>
<small>é‡‘é¡ (RM)</small><input type="number" id="f-amt" step="0.01">
<small>å‚™è¨»</small><input type="text" id="f-note" placeholder="å‚™è¨»æˆ–å•†å“åç¨±">
<button class="btn-action" style="background:var(--serenity)" onclick="saveRec()">ä¿å­˜è¨˜éŒ„ ğŸ›¡ï¸</button>
<button id="btn-del" class="btn-action" style="background:#EF5350;display:none" onclick="delRec()">ğŸ—‘ï¸ åˆªé™¤æ­¤æ¢è¨˜éŒ„</button>
<center><button onclick="closeAdd()" style="border:none;background:none;color:#999;padding:20px;">å–æ¶ˆ</button></center>
</div>
</div>

<script>
// === åˆå§‹åŒ–è³‡æ–™èˆ‡è¨­å®š ===
let db = JSON.parse(localStorage.getItem('dk_final_ultimate'))||{list:[],challenge:null,chalHistory:[]};
const CFG={acc:['RHB','HLB','TNG'],save:['âš”ï¸ ç¢©ç‰å­˜éŒ¢','ğŸ§§ æ„å¤–æ”¶å…¥','ğŸ’° å·¥è³‡'],spend:['ğŸ’¿ å°ˆè¼¯','âœ¨ å°å¡','ğŸ­ éŸ³æ¨‚åŠ‡','ğŸ›ï¸ åŒæ¬¾','ğŸ“¦ éƒµè²»','ğŸ± é£¯éŒ¢'],order:['âŒ æœªä»˜','âœ… å·²ä»˜','ğŸšš é‹é€ä¸­','ğŸ“¦ å·²æ”¶']};
let curT='save',curTag='',curAcc=CFG.acc[0],curOrder=CFG.order[1],editIdx=-1,liveRate=310,myChart=null;

// --- Excel å°å‡ºï¼ˆç¾åŒ–ç‰ˆï¼‰ ---
function doExport(){
  const filter=document.getElementById('export-month-sel').value;
  let rawData=filter==='all'?[...db.list]:db.list.filter(i=>i.date.startsWith(filter));
  rawData.sort((a,b)=> new Date(b.date)-new Date(a.date));

  const excelData=rawData.map(i=>({
    'ğŸ“… æ—¥æœŸ': i.date,
    'ğŸ·ï¸ é¡åˆ¥': (i.type==='save'?'ğŸŸ¢ ':'ğŸ”´ ')+i.tag,
    'ğŸ’° é‡‘é¡(RM)': i.amt,
    'ğŸ¦ è³¬æˆ¶': i.acc,
    'ğŸšš ç‹€æ…‹': i.order||'-',
    'ğŸ›’ ä¾†æº': i.source||'-',
    'ğŸ“ å‚™è¨»': i.note||''
  }));

  const header = ["ğŸ“… æ—¥æœŸ","ğŸ·ï¸ é¡åˆ¥","ğŸ’° é‡‘é¡(RM)","ğŸ¦ è³¬æˆ¶","ğŸšš ç‹€æ…‹","ğŸ›’ ä¾†æº","ğŸ“ å‚™è¨»"];
  const ws = XLSX.utils.json_to_sheet(excelData, {header});
  const range = XLSX.utils.decode_range(ws['!ref']);

  for(let C=range.s.c; C<=range.e.c; ++C){
    const cell = ws[XLSX.utils.encode_cell({r:0, c:C})];
    if(!cell.s) cell.s={};
    cell.s = { font:{bold:true,color:{rgb:"FFFFFF"}}, fill:{fgColor:{rgb:"92A8D1"}}, alignment:{horizontal:"center"} };
  }

  for(let R=1; R<=range.e.r; ++R){
    const amtCell = ws[XLSX.utils.encode_cell({r:R, c:2})];
    if(amtCell) amtCell.z = "#,##0.00";
  }

  ws['!cols']=[{wch:12},{wch:18},{wch:12},{wch:10},{wch:10},{wch:15},{wch:25}];
  ws['!autofilter']={ref:XLSX.utils.encode_range(range)};
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,"DK_ç†è²¡å ±è¡¨");
  XLSX.writeFile(wb,`DK_Report_${filter}.xlsx`);
}

// --- åŒ¯ç‡ ---
function fetchRate(){ fetch('https://api.exchangerate-api.com/v4/latest/MYR').then(r=>r.json()).then(d=>{ liveRate=d.rates.KRW; document.getElementById('rate-display').innerText=`1 RM = ${liveRate.toFixed(0)} â‚©`; }); }
fetchRate(); setInterval(fetchRate,60000);

// --- åˆ†é å°èˆª ---
function navTo(id,el){
  document.querySelectorAll('.page').forEach(p=>p.style.display='none');
  document.getElementById('p-'+id).style.display='block';
  document.querySelectorAll('.nav-link').forEach(n=>n.classList.remove('active'));
  if(el) el.classList.add('active');
  if(id==='chal'){updateChalUI(); renderChalHistory();}
  if(id==='home'){renderList(); initChart(); populateMonthSel();}
  if(id==='set') populateMonthExport();
}

// --- KRW è½‰æ› ---
function convertKrw(){const krw=parseFloat(document.getElementById('f-krw').value)||0;document.getElementById('f-amt').value=(krw/liveRate).toFixed(2);}

// --- æŒ‘æˆ°åŠŸèƒ½ ---
function updateDailyAmt(){const amt=parseFloat(document.getElementById('target-amt').value)||0;if(!db.challenge) document.getElementById('daily-suggest').innerText=`RM ${(amt/7).toFixed(2)}`;}
function startChal(){const amt=parseFloat(document.getElementById('target-amt').value);if(!amt) return alert("è«‹è¼¸å…¥ç›®æ¨™é‡‘é¡"); const start=new Date(),end=new Date(); end.setDate(start.getDate()+6); db.challenge={target:amt,start:start.toISOString().slice(0,10),end:end.toISOString().slice(0,10)}; save(); updateChalUI();}
function cancelChal(isCancel){const c=db.challenge;if(!c) return;if(isCancel){db.challenge=null; save(); updateChalUI(); return;} const saved=db.list.filter(i=>i.type==='save'&&i.date>=c.start&&i.date<=c.end).reduce((a,b)=>a+b.amt,0); const perc=((saved/c.target)*100).toFixed(1); db.chalHistory.unshift({...c,saved,perc}); db.challenge=null; save(); updateChalUI(); renderChalHistory();}
function updateChalUI(){
  const s=document.getElementById('chal-setup');
  const a=document.getElementById('chal-active');
  if(!db.challenge){s.style.display='block'; a.style.display='none'; updateDailyAmt(); return;}
  s.style.display='none'; a.style.display='block';
  const c=db.challenge;
  const today=new Date(); today.setHours(0,0,0,0);
  const diff=Math.ceil((new Date(c.end)-today)/(1000*60*60*24))+1;
  const daysLeft=Math.max(0,diff);
  const saved=db.list.filter(i=>i.type==='save'&&i.date>=c.start&&i.date<=c.end).reduce((a,b)=>a+b.amt,0);
  const perc=Math.min((saved/c.target)*100,100);
  document.getElementById('chal-dates').innerText=`${c.start} ~ ${c.end}`;
  document.getElementById('progress-bar').style.width=perc+'%';
  document.getElementById('progress-text').innerText=`${perc.toFixed(1)}% (RM ${saved.toFixed(2)}/${c.target})`;
  document.getElementById('days-left').innerText=daysLeft;
  const daily=(daysLeft>0)?Math.max(c.target-saved,0)/daysLeft:0;
  document.getElementById('daily-amt').innerText=`RM ${daily.toFixed(2)}`;
}
function renderChalHistory(){
  let html='<button class="btn-action" style="background:#EF5350;margin-bottom:10px;" onclick="clearChalHistory()">æ¸…ç©ºæ‰€æœ‰æŒ‘æˆ°æ­·å²</button>';
  html+=db.chalHistory.map((c,idx)=>`<div class="item-card">${c.start}~${c.end} | å„²è“„ ${c.saved.toFixed(2)}RM | é”æˆ ${c.perc}% <button style="background:#EF5350;color:white;border:none;border-radius:10px;padding:4px 8px;margin-left:8px;cursor:pointer;" onclick="delChalHistory(${idx})">åˆªé™¤</button></div>`).join('');
  document.getElementById('chal-history-list').innerHTML=html;
}
function delChalHistory(idx){db.chalHistory.splice(idx,1); save(); renderChalHistory();}
function clearChalHistory(){if(confirm("ç¢ºå®šæ¸…ç©ºæ‰€æœ‰æŒ‘æˆ°æ­·å²ï¼Ÿ")){db.chalHistory=[]; save(); renderChalHistory();}}

// --- è¨˜éŒ„/æ­·å² ---
function openAdd(){document.getElementById('modal-add').style.display='block'; populateTags(); populateAcc(); populateOrder();}
function closeAdd(){document.getElementById('modal-add').style.display='none'; editIdx=-1; document.getElementById('btn-del').style.display='none';}
function setT(t){curT=t; document.getElementById('ts').style.background=t==='save'? 'var(--serenity)':'#eee'; document.getElementById('ts').style.color=t==='save'?'#fff':'#999'; document.getElementById('tp').style.background=t==='spend'?'#eee':'#eee'; document.getElementById('tp').style.color=t==='spend'?'#999':'#999'; document.getElementById('row-spend').style.display=t==='spend'?'block':'none'; populateTags(); populateOrder();}
function populateTags(){ const bx=document.getElementById('bx-tag'); bx.innerHTML=''; const tags = curT==='save'? CFG.save:CFG.spend; tags.forEach(t=>{ const el=document.createElement('div'); el.className='tag'+(t===curTag? (curT==='save'?' sel-s':' sel-p'):''); el.innerText=t; el.onclick=()=>{curTag=t; populateTags();}; bx.appendChild(el); }); }
function populateAcc(){ const bx=document.getElementById('bx-acc'); bx.innerHTML=''; CFG.acc.forEach(a=>{ const el=document.createElement('div'); el.className='tag'+(a===curAcc?' sel-s':''); el.innerText=a; el.onclick=()=>{curAcc=a; populateAcc();}; bx.appendChild(el); }); }
function populateOrder(){ const bx=document.getElementById('bx-order'); bx.innerHTML=''; if(curT==='spend'){ CFG.order.forEach(o=>{ const el=document.createElement('div'); el.className='tag'+(o===curOrder?' sel-p':''); el.innerText=o; el.onclick=()=>{curOrder=o; populateOrder();}; bx.appendChild(el); }); } }

function saveRec(){
  const d=document.getElementById('f-date').value, amt=parseFloat(document.getElementById('f-amt').value), note=document.getElementById('f-note').value, source=document.getElementById('f-source').value||'', order=curT==='spend'?curOrder:'';
  const tag=curTag||'ä¸€èˆ¬', acc=curAcc;
  if(!d||!amt) return alert("æ—¥æœŸèˆ‡é‡‘é¡å¿…å¡«");
  if(editIdx>-1){db.list[editIdx]={date:d,type:curT,amt,tag,acc,order,source,note}; editIdx=-1;}
  else db.list.push({date:d,type:curT,amt,tag,acc,order,source,note});
  save(); closeAdd(); renderList(); updateChalUI(); initChart(); populateMonthSel();
}
function delRec(){if(editIdx>-1){db.list.splice(editIdx,1); editIdx=-1; save(); renderList(); closeAdd();}}
function renderList(){
  const month=document.getElementById('month-sel')?.value||'all';
  const filtered=(month==='all')?db.list:db.list.filter(i=>i.date.startsWith(month));
  const html=filtered.map((i,idx)=>`<div class="item-card ${i.type==='spend'?'is-spend':''}" onclick="editRec(${idx})">${i.date} | ${i.tag} | RM ${i.amt} | ${i.acc}</div>`).join('');
  document.getElementById('list-render').innerHTML=html;
}
function editRec(idx){
  editIdx=idx; const r=db.list[idx];
  document.getElementById('f-date').value=r.date; document.getElementById('f-amt').value=r.amt; document.getElementById('f-note').value=r.note||''; document.getElementById('f-source').value=r.source||''; curT=r.type; curTag=r.tag; curAcc=r.acc; curOrder=r.order||CFG.order[1]; setT(r.type); document.getElementById('btn-del').style.display='block'; openAdd();
}
function save(){localStorage.setItem('dk_final_ultimate',JSON.stringify(db));}

// --- æœˆåº¦åœ“é¤…åœ– ---
function initChart(){
  const month=document.getElementById('month-sel').value||'all';
  const data=db.list.filter(i=>month==='all'?true:i.date.startsWith(month));
  const income=data.filter(i=>i.type==='save').reduce((a,b)=>a+b.amt,0);
  const expense=data.filter(i=>i.type==='spend').reduce((a,b)=>a+b.amt,0);
  const ctx=document.getElementById('monthChart');
  if(myChart) myChart.destroy();
  myChart=new Chart(ctx,{type:'pie',data:{labels:['æ”¶å…¥','æ”¯å‡º'],datasets:[{data:[income,expense],backgroundColor:['#92A8D1','#F7CAC9']}]},options:{responsive:true}});
  document.getElementById('month-summary').innerText=`æ”¶å…¥ RM ${income.toFixed(2)} | æ”¯å‡º RM ${expense.toFixed(2)} | æ·¨é¡ RM ${(income-expense).toFixed(2)}`;
}
function populateMonthSel(){
  const sel=document.getElementById('month-sel');
  const months=[...new Set(db.list.map(i=>i.date.slice(0,7)))].sort((a,b)=>b.localeCompare(a));
  sel.innerHTML='<option value="all">å…¨éƒ¨æœˆä»½</option>'+months.map(m=>`<option value="${m}">${m}</option>`).join('');
  initChart();
}
function populateMonthExport(){
  const sel=document.getElementById('export-month-sel');
  const months=[...new Set(db.list.map(i=>i.date.slice(0,7)))].sort((a,b)=>b.localeCompare(a));
  sel.innerHTML='<option value="all">å…¨éƒ¨æœˆä»½</option>'+months.map(m=>`<option value="${m}">${m}</option>`).join('');
}
function doImport(f){
  const r=new FileReader();
  r.onload=e=>{
    const d=XLSX.read(e.target.result,{type:'binary'});
    const json=XLSX.utils.sheet_to_json(d.Sheets[d.SheetNames[0]]);
    json.forEach(i=>{db.list.push({date:i['ğŸ“… æ—¥æœŸ'],type:i['ğŸ·ï¸ é¡åˆ¥'].startsWith('ğŸŸ¢')?'save':'spend',tag:i['ğŸ·ï¸ é¡åˆ¥'].slice(2),amt:i['ğŸ’° é‡‘é¡(RM)'],acc:i['ğŸ¦ è³¬æˆ¶'],order:i['ğŸšš ç‹€æ…‹'],source:i['ğŸ›’ ä¾†æº'],note:i['ğŸ“ å‚™è¨»']});});
    save(); renderList(); initChart(); populateMonthSel();
  };
  r.readAsBinaryString(f.files[0]);
}
function clearAll(){if(confirm("ç¢ºå®šæ¸…ç©ºæ‰€æœ‰æ•¸æ“šï¼Ÿ")){db={list:[],challenge:null,chalHistory:[]}; save(); renderList(); initChart(); populateMonthSel(); updateChalUI(); renderChalHistory();}}

// --- åˆå§‹åŒ– ---
navTo('chal');
</script>
</body>
</html>
